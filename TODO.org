#+title: Project Trueflow TODOs
#+STARTUP: content hidestars

* TODO [High] Review Chain Of Trust
  Reviews can be signed by known PGP keys, and this can extend/scale into a network
  of trusted code. For example, open source libraries could accumulate layers of
  reviews from many individuals (across companies), and we can cryptographically
  verify who reviewed what.

* Emacs Package (vet.el)
** TODO [High] Basic Infrastructure
   - [ ] Define `vet-mode` and basic buffer setup.
   - [ ] Implement `vet-core.el` wrapper for CLI calls (`trueflow diff`, `trueflow mark`, `trueflow sync`).
   - [ ] Define customization groups (executable path, faces).

** TODO [High] Status View (`vet-status`)
   - [ ] Render "Unreviewed Hunks" section.
   - [ ] Implement `vet-refresh` to parse JSON from CLI.
   - [ ] Bind `g` to refresh, `q` to quit window.

** TODO [High] Review Actions
   - [ ] Implement `a` (Approve) command.
   - [ ] Implement `c` (Comment) command with minibuffer prompt.
   - [ ] Implement `x` (Reject) command.
   - [ ] Wiring: Execute `trueflow mark`, then refresh UI.
   - [ ] Add a small "reviewed!" animation in review mode when approving/commenting.
   - [ ] Show reviewed vs remaining counts in bottom-right (e.g., 5 / 15), with green reviewed and yellow remaining.

** TODO [Medium] Iterative Review Mode
   - [ ] Command `vet-review-start` (bound to `r`).
   - [ ] Walk through hunks one by one.
   - [ ] Implement side-by-side view (Diff vs New Content).

** TODO [High] Inline Editing
   - [ ] Bind `e` to jump to file location.
   - [ ] **Complex:** Implement true inline editing where changes in the review buffer apply to the file.
     - *Draft Plan:* Use `ediff` or a custom overlay that writes back to file on `C-c C-c`.
     - *Alternative:* Use `recursive-edit` in the file buffer.

* CLI Improvements (vet-cli)
** TODO [Medium] `trueflow check`
   - [ ] Implement CI gate logic (exit 1 if unreviewed hunks exist).

* Attestation & Verification
** TODO [Medium] Add Record::new constructor in store.rs
   - [ ] Encapsulate generation of `Uuid`, `SystemTime`, and `CURRENT_VERSION` in `Record::new` to simplify `mark.rs`.
** TODO [Medium] Cache imported pubkeys in Verifier
   - [ ] Optimize verification by maintaining a `HashSet` of imported key fingerprints to avoid redundant `gpg --import` calls.
** TODO [Medium] Refactor GPG logic into src/gpg.rs
   - [ ] Extract `GpgClient` to handle temp dir lifecycle and provide high-level `sign` and `verify` methods.

* Product & Platform Roadmap
** TODO [High] Review ordering prioritizes tests
   - [ ] Sort blocks so test code is reviewed first (need reliable test detection).
** TODO [High] Coverage mode + heatmap
   - [ ] Add `trueflow coverage` command that shells out to `cargo llvm-cov` or `just coverage`.
   - [ ] Add coverage mode to show least-reviewed files.
   - [ ] Add per-file heatmap (red = unreviewed, blue = well-reviewed).
** TODO [High] Coverage overlay and branch/path analysis
   - [ ] Add an overlay/command to show reviewed vs unreviewed lines and coverage.
   - [ ] Extend coverage to code paths/branches where possible.
** TODO [High] Semantic coverage by AST/codepath
   - [ ] Model how well reviewed a codepath is using AST relationships.
** TODO [High] Cognitive complexity scoring
   - [ ] Compute a complexity score per block to trigger review thresholds.
** TODO [High] Language coverage sweep
   - [ ] Add top 16 languages/markdown variants.
   - [ ] Add an `all_langs` repo fixture and E2E smoke tests per language.
** TODO [High] Review types/modes
   - [ ] Support review types (security, dependencies, performance, readability, data structures, business logic).
   - [ ] Tag reviews with a type and make modes affect block ordering and filters (e.g., data structures shows structs).
** TODO [High] GitHub PR integration
   - [ ] Fetch/check out PRs, map review targets to the right diff, and post feedback as comments.
** TODO [High] Local LLM context helper
   - [ ] Call a local model to explain context behind a change.
** TODO [High] Rust lint/check sweep
   - [ ] Evaluate high-quality Rust lints (deny, udeps, semver-checks, geiger, nextest) and wire into `just check`.
** TODO [High] Installation experience
   - [ ] Formalize a high-quality install plan (cargo install vs curl | sh vs package managers).
** TODO [Medium] Add strict cargo clippy lints, apply fixes
** TODO [Medium] Perform in-depth cargo mutants run, apply fixes
** TODO [Medium] Add some padding (maybe one line ish) of space between end of
   code block area and controls in TUI
** TODO BUG: this output in TUI:
```
struct #[derive(Debug, Clone)] in ./example_repos/all_languages/main.rs (hash=a85ccbc9), subblocks:
                                                  └─ CodeParagraph


                                                         #[derive(Debug, Clone)]
                                                         struct Config {
                                                             name: String,
                                                             threshold: i32,
                                                         }
```
Two things:
  1. struct #[derive(Debug, Clone)] is wrong, should be struct Config
  2. Let's make the output a little nicer to read:
     (no ./)
     example_repos/all_languages/main.rs
       -> struct Config (hash=a85ccbc9)
         {directly embed the subblock tree here}

** TODO [READY] TUI UX: no need for Trueflow TUI text/title at the top of the TUI.
** TODO [READY] TUI UX: need a command to like batch approve a whole file (or module or dir, etc.)
** TODO [READY] TUI UX: the modal when entering a comment shouldn't obscure the
   content beneath it, but be side-by-side or below, so all of the content is
   visible.
** TODO [READY] WHen the comment modal comes up, it should give command hints on how to submit the comment.
** TODO When you write a lot into a comment modal in the TUI, it doesn't wrap
   the text in the box. It just goes invisible off-frame. This is a bug.
** TODO [READY] There should be a trueflow command to reset the review state for the
   current user for the current REV. i.e. delete all review records that point
   to the current rev. (without removing historical reviews, etc.)
** TODO [READY] There should be a trueflow CLI command to just list records in
   reverse-chronological order, like a trueflow log command, defaults to say the
   most recent 16 or something.
** TODO [Medium] Diff vs new-content investigation
   - [ ] Define and verify how we present hunks versus reconstructed new content.
** TODO [Medium] jj integration
   - [ ] Explore how Jujutsu can improve diffing, review, and syncing flows.
** TODO [Medium] Website + docs
   - [ ] Add landing page, user docs, and onboarding guide.
** TODO [Medium] Static musl build + dependency audit
   - [ ] Ship a fully static musl build.
   - [ ] Audit dependencies; prefer pure Rust and reduce OpenSSL/FFI usage.
** TODO [Medium] Vultr deployment (org meta repo)
   - [ ] Spin up Vultr infra and document deployment via the org meta repo.
** TODO [Low] Performance sweep
   - [ ] Audit for performance improvements and implement top candidates.
** TODO [Medium] Add mode in review for speed-reading word-by-word SPC -> pause;
   j back sentence; l forward sentence
